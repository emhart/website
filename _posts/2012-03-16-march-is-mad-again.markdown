---
layout: post
title: "March is MAD!!!! (again)."
date: 2012-03-16
comments: false
tags: [R,bayes,sports,statistics]
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://cdn.slashgear.com/wp-content/uploads/2012/02/cbssports.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="142" src="http://cdn.slashgear.com/wp-content/uploads/2012/02/cbssports.png" width="200" /></a></div>Well, it's come to that time of the year again, a moment that brings me back to my first brackets that I filled out in 7th grade.  Back then I didn't care that much about college basketball, so I just made guesses.  Not much has changed in 20 years.  I still don't care that much about college basketball, but how I guess has gotten much better.  These days I use a pretty simple simulation model with a tried and true Bayesian core to it.  I have an old post on this model from two years ago, but I think its time for an update.  Lots of people have fun modeling the tournament, <a href="http://fivethirtyeight.blogs.nytimes.com/author/nate-silver/">Nate Silver</a> at the New York times has a good model on his <a href="http://fivethirtyeight.blogs.nytimes.com/2012/03/13/fivethirtyeight-picks-the-n-c-a-a-bracket/">538 blog</a>, as does a group over at Georgia Tech called the <a href="http://www2.isye.gatech.edu/~jsokol/lrmc/">LMRC headed by Joel Sokol</a>.  My own model is probably the simplest of all of these, but it shares its DNA with Nate Silvers. Here's the overview.<br /><br /><b>Model description</b><br /><br>The guts of my model are a simple Bayesian <a href="http://lingpipe-blog.com/2009/09/23/bayesian-estimators-for-the-beta-binomial-model-of-batting-ability/">Beta-Binomial posterior</a> distribution. This is composed of two parts, one is a Binomial distribution, which is simply the probability that team A beats team B.  The next is the prior distribution.  Most often in ecology we would use a flat prior, but because this is sports we have lots of background data.  Already it should be clear we have problem.  That's right, often times team A has never played team B, and certainly not enough times to have any data.  So the first thing we need to do is get some data.  My way around this is to use Ken Pomeroy's ratings.  He gives each team a "Pythagorean" ranking.  What's convenient about his rankings is that you can take any two teams and convert their rankings into a probability, let's call it <i>p</i>, that team A beats team B.  We do this using a simple formula called the log5 odds.  Here's how its implemented in the code <pre class="brush:python" name="code"><br />l5rule <- function(ratings){<br />a <- ratings[1]<br />b <- ratings[2]<br />wpct <- (a - (a*b))/ ((a + b) - (2*a*b))<br />return(wpct)}<br /></pre>Based on this win percentage, I simulate a 34 game season between the teams, based on that <i>p</i>.  That's the binomial part of my posterior.  Next I want to include prior information with that simulated data, otherwise there's no real need for simulation, I could just use the log5 odds rule to calculate everything.  I do this by creating a Beta distribution based on power rankings from two other experts, <a href="http://www.usatoday.com/sports/sagarin/bkt1112.htm">Jeff Sagarin</a> and <a href="http://sonnymoorepowerratings.com/m-basket.htm">Sonny Moore</a>.  I use their rankings to create a Beta distribution centered around the <i>p</i> that team A beats team B.  So now I have my "data" based on the Pomeroy rankings, and the prior.  I combine this into into my posterior and I generate a single draw from that posterior distribution.  I work through the entire tournament, simulating it 10,000 times and generate a table of probabilities that each team makes it to the each stage in the tournament.  You can <a href="https://docs.google.com/spreadsheet/ccc?key=0AvM0mgmVJAKUdFNqdmdVblZ3d2ZFWmdiWXJ0dXBObWc">see my results here</a>.  Predictions are blue highlighted cells, and actual outcomes are red text.  So far I've had about 80% accuracy.  So far its on par with the LMRC model.  You can see all the <a href="https://github.com/emhart/Misc_Func/tree/master/NCAAModel">code on github.</a><br><br><b>Last thoughts</b><br><br> My personal bracket in my pool is outperforming my model.  I sort of cheated on myself filling it out.  One of the great things about the tournament is that you know there will be upsets...but which ones will they be?  My model doesn't really account for that, but there is a model that does. Over at the <a href="http://harvardsportsanalysis.wordpress.com/2012/03/12/predicting-ncaa-tournament-upsets-the-importance-of-turnovers-and-rebounding/">Harvard sports analysis group</a> they have a great model that they used, and based on that I threw some upsets into my own picks.  I'll be back later with more updates on how it performs.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Amy Hurford</div>
<div class='content'>
Those 15 v 2 upsets have to hurt! I like the Orange. They&#39;ve not been looking good in the first two rounds, but I&#39;ll stick with them. If the Orange go down, then I&#39;m switching to Mich St. What&#39;s with CBSsports.com not broadcasting to Canada this year? Agh!</div>
