---
layout: post
title: "How many ecologists were on ECOLOG in 1992?"
date: 2012-06-25
comments: false
categories:
 - programming
 - Just for kicks
 - ecolog
 - R
---

<div class='post'>
<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/_HyQ0kHazf5g/R1H5feOvImI/AAAAAAAAAV4/unfbkQT0dX4/s1600-R/RS628~Nirvana-Rolling-Stone-no-628-April-1992-Posters.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="200" src="http://4.bp.blogspot.com/_HyQ0kHazf5g/R1H5feOvImI/AAAAAAAAAV4/unfbkQT0dX4/s200-R/RS628~Nirvana-Rolling-Stone-no-628-April-1992-Posters.jpg" width="166" /></a></div>Remember 1992? I had just turned 13 and was still a year away from highschool when my true descent into nerdom and the internet would begin.  Back then it was with a local BBS (Bulletin Board System) run by a guy in a trailer park named Charlie and a 1200 baud modem on an old Compaq 386.  But there were some intrepid ecologists who were already forging ahead with what we take for granted 20 years later, Ecolog.  Last September, Ecolog hit 13000 subscribers.  I took the data that David mentioned in his post and <a href="http://currentecology.blogspot.ca/2011/09/just-for-kicks-i-took-recently-post.html">plotted it out and fitted a curve to it.</a> The fit was based on an assumption of there being 100 subscribers when Ecolog first started.  On Sunday he posted that there were now 15,000 subscribers so I decided to see how good my fit was. Here's the original fit with new the new data point and the prediction (in red),I fit this exponential growth equation: <br><center><a href="http://www.codecogs.com/eqnedit.php?latex=N(d)=N_0e^{(rd)}" target="_blank"><img src="http://latex.codecogs.com/gif.latex?N(d)=N_0e^{(rd)}" title="N(d)=N_0e^{(rd)}" /></a></center> <br />where <i>r</i> in the growth rate, and <i>d</i> is the number of days since Sept. 1 1992, and <br><center><a href="http://www.codecogs.com/eqnedit.php?latex=N_0=100" target="_blank"><img src="http://latex.codecogs.com/gif.latex?N_0=100" title="N_0=100" /></a></center><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-Mv48s2qYmis/T-kciBDu3GI/AAAAAAAADUE/LL_eH-OVi78/s1600/poorfit.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="320" src="http://4.bp.blogspot.com/-Mv48s2qYmis/T-kciBDu3GI/AAAAAAAADUE/LL_eH-OVi78/s320/poorfit.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">The solid black dot is the true value, <br />the red dot the fitted for the new data point</td></tr></tbody></table><br />What should that initial starting value be?  Clearly it's not 100.  Let's begin by assuming that Ecolog grew exponentially.  We're missing a huge amount of data, so I'll say up front that yes I know that there could be any number of weird things that happened between the start year of 1992 and the first year we have data, 2006.  But exponential growth isn't an unreasonable assumption.  We know it's not linear, a linear fit gives you ~ -15,000 subscribers at time 0! We could make guesses and keep plotting to eyeball our fit.   The first problem to solve is how do we figure out the best fitting value for N0?  It's a perfect problem for the built-in optimization functions that R has, optim(). First we define a function that we want to minimize.  Here we just use nls() with different values for N0 and minimize the deviance, and just plug that into optim(). <br /><pre class="brush:python" name="code">fp.est &lt;- function(param,dat){<br />  z &lt;- nls(dat[,2]~param*exp(r*dat[,1]),start=list(r=.001))<br />  return(deviance(z))<br />}<br />tmp &lt;- optim(1,fp.est,dat=dat,method="L-BFGS-B",lower=1,upper=6000)<br /><br /></pre>That gives us a perfectly reasonable point estimate of 545, and vastly improves our fit as you can see.<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-vO6v-nAErac/T-kiFngA0wI/AAAAAAAADUQ/uoWI5FdICOk/s1600/goodplot.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://2.bp.blogspot.com/-vO6v-nAErac/T-kiFngA0wI/AAAAAAAADUQ/uoWI5FdICOk/s320/goodplot.png" width="320" /></a></div><br />We can even get a little creative with the data and come up with a measure of standard deviation.  We do this with a jackknife style estimate of variance.  Jackknife estimates are type of resampling that work by calculating some statistic repeatedly by removing one or more of the data points.  All we do is come up with all possible combinations for our data that have 8 out 9 points, and run our optimization routine.  This yields a final estimate for the number of subscribers of Ecolog at the very beginning as:  <br><center><a href="http://www.codecogs.com/eqnedit.php?latex=N_0 = 545 \pm 33.8" target="_blank"><img src="http://latex.codecogs.com/gif.latex?N_0 = 545 \pm 33.8" title="N_0 = 545 \pm 33.8" /></a></center><br>I have no idea if this is right, but it's a neat little example of using optim() and jackknifing to solve a problem where we have good intuition (that exponential growth is the right function) and not very much data.  Here's<a href="http://gist.github.com/2992981"> a gist of all the cod</a>e that this post used.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Ted Hart</div>
<div class='content'>
Thanks Drew.  It does work, it gives you about the same answer.  This solution I presented because I was thinking of the problem in two steps, one where we actually should know N_0, and use that to estimate r.  But you&#39;re right, other than just as a trivial example of using optim() there&#39;s no reason not to use nls().  The only real reason I can think of is that the optim() method here is a bit more robust to hitting errors like: &quot;Error....Singular gradient&quot;</div>
</div>
<div class='comment'>
<div class='author'>Drew Tyre</div>
<div class='content'>
Very cool Ted! Why not use nls() to fit both parameters? I haven&#39;t messed with your code to see if that would work, but can&#39;t think of a reason offhand why it wouldn&#39;t?</div>
</div>
</div>
